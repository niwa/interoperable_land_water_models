# Results Aggregator

This is a bmi-compliant "model" that uses a weighted averaging scheme to aggregate values from a table in SQLite into a smaller number of values in another table.

The purpose of the program is to group results from small areas into larger ones -- e.g. from farms to river catchments. We anticipate that it will be used in combination with the iterator, and read the results from that program as inputs.

## Contents

#### Folders

* data
  * aggregator.yaml -- a sample configuration file
  * WeightedAverage.db -- a sqlite database with three tables
    * Inputs -- numerical values one-to-one with entities
    * Weights -- entities grouped to zones with weights 
    * AveragedResults -- weighted averages of inputs one-to-one with zones
* src -- source code
* builds -- CMake stuff goes here

## Program Notes

The weighted averages are generated by this SQL:

```SQL
Insert into AveragedResults
Select Zone, sum(Score * Weight)/sum(Weight) as Average
from Weights
inner join Inputs on Inputs.Id = Weights.Id
group by Zone;
```

### To Do

* Allow input table to be in a different database from the table of weights
* Same for output table
* Output table must exist prior to run. Consider building it on the fly
* All existing contents of output table are deleted before the results are posted. Consider a more flexible arrangement
